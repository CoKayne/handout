---
author: oxolane
title: 動態規劃dp
date: 2020 未知
---


# 動態規劃是什麼

## 
DP是一個想法 而不是一個固定演算法

## 
通過把原問題分解為相對簡單的子問題的方式
求解複雜問題的方法

## 用空間換取時間

[逆向抗日](https://zh.wikipedia.org/wiki/%E4%BB%A5%E7%A9%BA%E9%96%93%E6%8F%9B%E6%99%82%E9%96%93)


# 動態規劃需要以下特性：

## 

1. 重複子問題
2. 最佳子結構
3. 無後效性

## 重複子問題

相同的一個子問題
會被多次需要

否則也沒有記憶的必要



## 最佳子結構

當問題被拆成若干個規模較小的問題時
可以透過這些子問題得到這個問題的最佳解

否則也沒有計算子問題的必要



## 無後效性：
 
決策圖是個 DAG (Directed acyclic graph, 有向無環圖)

否則無法階段性決策
也就是無法確定當前狀態的結果


# DP步驟

## 

1. 決定狀態和轉移
2. 確定滿足動態規劃的前提
3. 估計複雜度並確定邊界條件



## 估計複雜度

DAG 上最多會拜訪的節點數量 + 轉移次數的總和


# 東東爬階梯 (Zerojudge d212)

## 

問題：

東東有個嗜好，爬階梯不是一次走一階，就是一次走兩階。

換句話說，假設階梯有三階，那他有三種走法

一：第一步走一階，第二步走二階。

二：第一步走二階，第二步走一階。

三：全程都走一階。

這題要問你，假設階梯有 $n$ 階，那東東有幾種走法?


## 狀態

令 $dp[i]$ :
走到第 $i$ 階階梯的走法數量。

## 轉移

考慮最後一步是走一階還是二階：

1. 如果最後一步走一階，那對應的方法數是 $dp[i - 1]$

2. 如果最後一步走二階，那對應的方法數是 $dp[i - 2]$

因此 $dp[i] = dp[i - 1] + dp[i - 2]$

## 邊界條件

$dp[0] = 1, dp[1] = 1$

# 連續元素的和 (Zerojudge d784)

## 

問題：

已知一 $n$ 個元素的整數數列，找出該數列連續元素的和的最大值。

例如該數列為 $\lbrace 6, 10, -5, 7, -6, -1, -3 \rbrace$ ，則該數列的最大連續元素和 $=$ 前四項和 $= 6 + 10 + (-5) + 7 = 18$



## 狀態

令 $dp[i]$ :

以第 $i$ 個位置為結尾的最大連續元素和。


## 轉移

轉移分成兩種情況，分別是：

1. 接在前一個的最大連續和後面 $(dp[i - 1] + A[i])$

2. 自己開始一段新的連續和

由這兩種轉移取最大值，因此有：

$dp[i] = max(dp[i - 1] + A[i], A[i])$

## 

用 $dp[i]$ 表示 「以第 $i$ 個位置為結尾」 的狀態是一個在許多題目都通用的常見手法。


# 2016年亞太數學奧林匹亞競賽 初選第6題 (Zerojudge c434)

## 
問題：
設集合 $A = \lbrace 1, 2, 3, ..., N \rbrace$ ，試求出 $A$ 中有多少個子集含有三個或三個以上的連續整數。

原題 $N = 12$ ，答案為 $2391$ ，有興趣可以自己手算看看。

## 

對排列組合有經驗一點的人都會發現，這題從正面算似乎不太好算，我們可以考慮反過來求 「有多少個子集不含三個或三個以上的連續整數」，最後再用 子集總數 $2^N$ 扣掉這個數字即可。



## 狀態

$dp0[i] :=$ 目前 $i$ 以前(包含 $i$ )的正整數都考慮過了，目前最後有連續 $0$ 個數字被選入集合的子集數量

$dp1[i] :=$ 目前 $i$ 以前(包含 $i$ )的正整數都考慮過了，目前最後有連續 $1$ 個數字被選入集合的子集數量

$dp2[i] :=$ 目前 $i$ 以前(包含 $i$ )的正整數都考慮過了，目前最後有連續 $2$ 個數字被選入集合的子集數量


## 轉移

考慮 $i$ 不放入集合，則有： 
$dp0[i] = dp0[i - 1] + dp1[i - 1] + dp2[i - 1]$

考慮 $i$ 放入集合中，則有以下兩個轉移：
1. $dp1[i] = dp0[i - 1]$
2. $dp2[i] = dp1[i - 1]$



## 邊界條件

$dp0[0] = 1$
$dp1[0] = 0$
$dp2[0] = 0$



最後，「有多少個子集不含三個或三個以上的連續整數」這個數量就是 $dp0[N] + dp1[N] + dp2[N]$

答案也就是 $2^N - dp0[N] - dp1[N] - dp2[N]$


# LCS (POJ 1458)

## 

==L==ongest 

==C==ommon 

==S==ubsequence

## 

問題：
給你兩個字串，問兩個字串的最長公共子序列。


## 狀態

令 $dp[i][j]$:
已考慮 $A$ 的前 $i$ 個字符，$B$ 的前 $j$ 個字符時的解



## 轉移

$dp[i + 1][j] = max(dp[i + 1][j], dp[i][j])$
$dp[i][j + 1] = max(dp[i][j + 1], dp[i][j])$
$dp[i + 1][j + 1] =$
$max(dp[i + 1][j + 1],dp[i][j] + (A[i] == B[j]))$



## 邊界條件

$dp[0][0] = 0$，超界不理

-

![](https://i.imgur.com/YLZLNls.png)


# 0/1 背包問題 (Zerojudge a587)

## 
問題：
你有 $N$ 個物品，第 $i$ 個物品的價值為 $V_i$，重量為 $W_i$。
每個物品只能選擇取或不取。
你的背包至多只能裝下 $M$ 的重量，問你最大總價值。



## 狀態

令 $dp[i][j]$: 
已考慮前 $i$ 個物品，
且背包重量為 $j$ 的情況下的最大總價值。

![](https://i.imgur.com/zhWxmSt.png)


# 無限背包問題

## 
問題：
你有 $N$ 個物品，
第 $i$ 個物品的價值為 $V_i$，重量為 $W_i$。
每個物品都可以選擇 $0$ ~ $∞$ 個。
你的背包至多只能裝下 $M$ 的重量，問你最大總價值。



## 狀態

令 $dp[i][j]$:
已考慮前 $i$ 個物品，
且背包重量為 $j$ 的情況下的最大總價值。

![](https://i.imgur.com/zhT4OZ7.png)


# 多重背包問題

## 

問題：
你有 $N$ 個物品，
第 $i$ 個物品的價值為 $V_i$，重量為 $W_i$。
每個物品都可以選擇 $0$ ~ $C_i$ 個。
你的背包至多只能裝下 $M$ 的重量，問你最大總價值。



基於二分拆解的解法：

## 狀態

令 $dp[i][j]$:
已考慮前 $i$ 個物品，
且背包重量為 $j$ 的情況下的最大總價值。
接著，我們把每個物品分割成若干個新的物品，
例如：

$C_i = 20$ => $1 + 2 + 4 + 8 + 5$



於是只要將每個物品分裂成 $O(lg C)$ 個 $0/1$ 物品，
就可以用 $0/1$ 背包解決。



![](https://i.imgur.com/kI4fDOX.png)


# 最大子方陣

## 
問題：
給你一個 $0/1$ 矩陣。
求一個最大的方陣，使得整個方陣都只由 $1$ 構成。



## 狀態
令 $dp[i][j]$:
以 $(i, j)$ 為右下角的最大子方陣邊長。

![](https://i.imgur.com/9RUkZBU.png)


# 狀態壓縮 (2015年亞太數學奧林匹亞競賽 初選第4題)

## 

問題：
在 $2 × N$ 的方格 (方格的編號為 $1 ∼ N$) 中選取若干個格子塗成黑色(也可以全部不選)，使得任兩個黑色的格子都不共邊的方法有幾種？

原題 $N = 7$ ，答案為 $577$ ，有興趣可以自己手算看看。



## 狀態

$dp[i]$$[$黑白$] :=$ 前i行的方法已經考慮完，且第i行的兩個格子是依序是「黑白」的方法數。
$dp[i]$$[$白黑$] :=$ 前i行的方法已經考慮完，且第i行的兩個格子是依序是「白黑」的方法數。
$dp[i]$$[$白白$] :=$ 前i行的方法已經考慮完，且第i行的兩個格子是依序是「白白」的方法數。

*注：直行橫列


# TIOJ 1908 大根蘿蔔

## 

題意：
你有一個 $N * N$ 的矩陣，
每個格子都有價值。
你選一個格子後，
周圍九宮格的格子都不可以取。
問最大總價值。

$N ≤ 22, TL: 4000 ms, ML: 128 MB$



## 狀態

$dp[i][j] := 已考慮前 i 行，並且最後一行可以用\ j\ 二進位描述$

## 

因為記憶體卡的有點緊，
我們要用「滾動陣列」技巧。

注意到我們只在意前一行，
所以我們不需要特別開很大的記憶體
紀錄我們考慮了幾行。

## 

但是狀態數還是有 $O(2^{22})$。

## 

真的有那麼多狀態嗎?

## 

考慮一行，由左到右。
如果決定這格要拿，下次拿就是兩格後。
否則不拿，下一格開始可以拿。

## 

$T(N) := N 個元素一排，合法的取法數量$
$= T(N - 1) + T(N - 2)$
->
$T(22) < 20000$

實際上狀態很少嘛!

## 

所以我們一開始就可以進行預處理，
哪些行的狀態是可能的，
往後都只考慮這些狀態。

# 數位統計 (延伸閱讀)

## 

例題：
給你 $L$, $R$，$1 ≤ L ≤ R ≤ 1e18$，
問 $[L, R]$ 中不含 “87” 的數字有多少個？

如果可以計算 $[1, x]$ 中含 “87” 的數字數量，
那 $[L, R]$ 中含 “87” 的數字數量就可以被計算。

![](https://i.imgur.com/BcRfJlq.png)

## 狀態

$dp[已從最高位考慮了幾個位數][前綴比 x 的前綴小]$
$[尾數是 8][含 “87”]$ ： 符合條件的數字數量

轉移 => 枚舉下一個尾數 $d$

若這個狀態的前綴比 $x$ 的前綴小，
那麼 $d$ 可以枚舉 $[0, 9]$。

否則 $d$ 只能枚舉 $[0, 下一個位數在 x 中的數字]$。

![](https://i.imgur.com/q1ODjEm.png)


# 遺珠之憾

## 

1. 斜率優化
2. 分治優化
3. 四邊形不等式 dp優化
4. 帶感情的dp優化 (IOI 2016 Aliens)
5. 插頭dp
6. 狀態玄妙的dp


# 題目 QA

## 題目-1
- [好題庫](https://atcoder.jp/contests/dp)
- [ZJ-c878](https://zerojudge.tw/ShowProblem?problemid=c878)

## 題目-2
1. Codeforces 811 C. Vladik and Memorable Trip
2. Codeforces 51 D. Beautiful numbers
3. ARC 073 D - Simple Knapsack
4. Codeforces 803 E. Roma and Poker
5. ARC 071 F - Infinite Sequence
6. Codeforces 244 B. Undoubtedly Lucky Numbers

## 題目-3

7. Codeforces 768 D. Jon and Orbs
8. Codeforces 767 C. Garland
9. POI 2 Stage 2 The Right-Turn Drivers' Club
10. Codeforces 788 A. Functions again
11. Codeforces 792 C. Divide by Three
12. Codeforces 1012 C. Hills

## Q&A